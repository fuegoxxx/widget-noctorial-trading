        
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analizador de Consistencia de Lotes</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            margin: 20px;
            padding: 0;
            background-color: #f6f5f4; /* Fondo de Notion */
            color: #37352f; /* Texto de Notion */
            line-height: 1.6;
        }
        .container {
            max-width: 600px;
            margin: auto;
            padding: 20px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(15, 15, 15, 0.1);
        }
        h2 {
            font-size: 1.5em;
            color: #37352f;
            border-bottom: 2px solid #37352f;
            padding-bottom: 5px;
        }
        .input-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
        }
        input[type="number"], button {
            width: calc(100% - 20px);
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
            font-size: 1em;
        }
        button {
            background-color: #2e83f2;
            color: white;
            border: none;
            cursor: pointer;
            margin-top: 10px;
        }
        button:hover {
            background-color: #1e63c0;
        }
        #results {
            margin-top: 20px;
            padding: 15px;
            border-radius: 6px;
        }
        .result-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }
        .status {
            font-weight: bold;
        }
        .status.ok {
            color: #28a745; /* Verde para 'en rango' */
        }
        .status.warning {
            color: #ffc107; /* Amarillo para precaución */
        }
        .status.error {
            color: #dc3545; /* Rojo para 'fuera de rango' */
        }
        #storage-info {
            font-size: 0.8em;
            color: #888;
            margin-top: 15px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h2>Analizador de Consistencia de Lotes</h2>
        <p>Introduce el lote de tu nueva operación para saber si está en el rango correcto. La aplicación recordará tus totales automáticamente.</p>

        <div class="input-group">
            <label for="current-lot">Lote de la operación actual:</label>
            <input type="number" id="current-lot" placeholder="Ej. 0.5" step="0.01">
        </div>

        <button id="add-lot">Agregar Lote y Actualizar</button>

        <div id="results">
        </div>

        <div id="storage-info">
            <p><strong>Totales guardados:</strong></p>
            <p>Operaciones: <span id="num-ops-display">0</span></p>
            <p>Suma de Lotes: <span id="sum-lots-display">0</span></p>
            <button id="reset-data" style="width: auto; padding: 5px 10px;">Reiniciar datos</button>
        </div>
    </div>

    <script>
        const currentLotInput = document.getElementById('current-lot');
        const addLotButton = document.getElementById('add-lot');
        const resetDataButton = document.getElementById('reset-data');
        const resultsDiv = document.getElementById('results');
        const numOpsDisplay = document.getElementById('num-ops-display');
        const sumLotsDisplay = document.getElementById('sum-lots-display');

        // Función para cargar datos desde el almacenamiento local
        function loadData() {
            let numOps = parseFloat(localStorage.getItem('numOps')) || 0;
            let sumLots = parseFloat(localStorage.getItem('sumLots')) || 0;
            updateDisplay(numOps, sumLots);
            return { numOps, sumLots };
        }

        // Función para guardar datos en el almacenamiento local
        function saveData(numOps, sumLots) {
            localStorage.setItem('numOps', numOps);
            localStorage.setItem('sumLots', sumLots);
            updateDisplay(numOps, sumLots);
        }

        // Función para actualizar la visualización de los totales
        function updateDisplay(numOps, sumLots) {
            numOpsDisplay.textContent = numOps;
            sumLotsDisplay.textContent = sumLots.toFixed(2);
        }

        // Función para calcular y mostrar los resultados
        function updateResults(numOps, sumLots, currentLot) {
            // Manejar el caso de la primera operación (numOps es 0)
            if (numOps === 0) {
                resultsDiv.innerHTML = `
                    <h2>Análisis</h2>
                    <div class="result-item">
                        <span>Tu primera operación:</span>
                        <span>${currentLot.toFixed(2)} lotes</span>
                    </div>
                    <div class="result-item">
                        <span>Estado:</span>
                        <span class="status ok">🟢 ¡Operación inicial establecida!</span>
                    </div>
                    <div class="result-item">
                        <span>Rango inicial:</span>
                        <span>Se establecerá entre ${ (currentLot / 2).toFixed(2) } y ${ (currentLot * 2).toFixed(2) }</span>
                    </div>
                `;
            } else {
                // Lógica para operaciones subsiguientes
                const avgLots = sumLots / numOps;
                const minAllowed = avgLots / 2;
                const maxAllowed = avgLots * 2;
                let statusClass = '';
                let statusText = '';

                if (currentLot >= minAllowed && currentLot <= maxAllowed) {
                    statusClass = 'ok';
                    statusText = '🟢 ¡Lote en rango!';
                } else {
                    statusClass = 'error';
                    statusText = '🔴 ¡Lote fuera de rango!';
                }

                resultsDiv.innerHTML = `
                    <h2>Análisis</h2>
                    <div class="result-item">
                        <span>Lote Promedio:</span>
                        <span>${avgLots.toFixed(2)}</span>
                    </div>
                    <div class="result-item">
                        <span>Rango Mínimo:</span>
                        <span>${minAllowed.toFixed(2)}</span>
                    </div>
                    <div class="result-item">
                        <span>Rango Máximo:</span>
                        <span>${maxAllowed.toFixed(2)}</span>
                    </div>
                    <div class="result-item">
                        <span class="status ${statusClass}">${statusText}</span>
                    </div>
                `;
            }
        }
        
        // Función para mostrar el análisis al cargar la página si hay datos guardados
        function showLastAnalysis() {
            const { numOps, sumLots } = loadData();
            if (numOps > 0) {
                const avgLots = sumLots / numOps;
                const minAllowed = avgLots / 2;
                const maxAllowed = avgLots * 2;
                
                resultsDiv.innerHTML = `
                    <h2>Análisis Actual</h2>
                    <div class="result-item">
                        <span>Lote Promedio:</span>
                        <span>${avgLots.toFixed(2)}</span>
                    </div>
                    <div class="result-item">
                        <span>Rango Mínimo:</span>
                        <span>${minAllowed.toFixed(2)}</span>
                    </div>
                    <div class="result-item">
                        <span>Rango Máximo:</span>
                        <span>${maxAllowed.toFixed(2)}</span>
                    </div>
                    <div class="result-item">
                        <span class="status ok">🟢 ¡Datos cargados!</span>
                    </div>
                `;
            }
        }

        // Evento al hacer clic en "Agregar Lote y Actualizar"
        addLotButton.addEventListener('click', () => {
            const currentLot = parseFloat(currentLotInput.value);
            if (isNaN(currentLot) || currentLot <= 0) {
                alert('Por favor, introduce un lote válido.');
                return;
            }

            let { numOps, sumLots } = loadData();
            updateResults(numOps, sumLots, currentLot);

            // Actualizamos los totales para la próxima operación
            numOps += 1;
            sumLots += currentLot;
            saveData(numOps, sumLots);

            currentLotInput.value = ''; // Limpiamos el campo de entrada
        });

        // Evento al hacer clic en "Reiniciar datos"
        resetDataButton.addEventListener('click', () => {
            if (confirm('¿Estás seguro de que quieres reiniciar todos los datos? Esto no se puede deshacer.')) {
                saveData(0, 0);
                resultsDiv.innerHTML = '';
            }
        });

        // Cargar los datos y mostrar el análisis al iniciar la página
        showLastAnalysis();

    </script>

         <div style="text-align: center; margin-top: 30px; font-size: 0.8em; color: #888;">
        <p>¿Te ha sido útil esta herramienta? <a href="https://paypal.me/necesitoverdes" target="_blank" style="color: #0070ba; text-decoration: none; font-weight: 500;">Apoya el desarrollo</a>.</p>
    </div>

</body>
</html>

